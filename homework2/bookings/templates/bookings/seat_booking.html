{% extends "base.html" %}
{% block title %}Book Seats · {{ movie.title }}{% endblock %}

{% block head_styles %}
<style>
  /* Seat grid & buttons – local to this page */
  .seats{
    display:grid; grid-template-columns:repeat(8,minmax(68px,1fr));
    gap:.6rem; max-width:640px;
  }
  .seat-btn{ width:100%; padding:.6rem 0; border-radius:.5rem; font-weight:600; letter-spacing:.5px; }
  .seat-selected{ background:var(--bs-primary); color:#fff; }
  .seat-booked{ background:var(--bs-danger); color:#fff; pointer-events:none; }
  .screen-bar{ height:4px; background:#ddd; border-radius:999px; margin:0 0 1rem; }
</style>
{% endblock %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h3 class="h4 mb-2">Book Seats for: <span class="fw-semibold">{{ movie.title }}</span></h3>
          <p class="text-muted small mb-1">
            Release: {{ movie.release_date|date:"M j, Y" }} · Duration: {{ movie.duration }} min
          </p>
          <p class="mb-3">{{ movie.description }}</p>

          <div class="screen-bar" title="Screen"></div>

          <form method="post">
            {% csrf_token %}
            <div class="seats mb-3">
              {% for seat in seats %}
                {% if seat.id in booked_seat_ids %}
                  <button type="button" class="btn seat-btn seat-booked" disabled>{{ seat.seat_number }}</button>
                {% else %}
                  <input class="d-none seat-checkbox" type="checkbox" name="seats" id="seat-{{ seat.id }}" value="{{ seat.id }}"
                         {% if seat.id|stringformat:"s" in selected_seats %}checked{% endif %}>
                  <label for="seat-{{ seat.id }}" class="btn btn-outline-success seat-btn">{{ seat.seat_number }}</label>
                {% endif %}
              {% endfor %}
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">Confirm Booking</button>
              <a class="btn btn-outline-secondary" href="{% url 'movie_list' %}">Cancel</a>
            </div>

            <div class="mt-3 small">
              <span class="badge text-bg-danger me-1">Booked</span>
              <span class="badge text-bg-success me-1">Available</span>
              <span class="badge text-bg-primary">Selected</span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  // Toggle selected styling on labels
  document.querySelectorAll('.seat-checkbox').forEach(cb => {
    const label = document.querySelector('label[for="'+cb.id+'"]');
    const sync = () => label.classList.toggle('seat-selected', cb.checked);
    cb.addEventListener('change', sync);
    sync();
  });
</script>
{% endblock %}
