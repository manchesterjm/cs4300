{% extends 'bookings/base.html' %}
{% block title %}Book Seats · {{ movie.title }}{% endblock %}
{% block content %}
<h2>Book Seats for: {{ movie.title }}</h2>
<p>Release: {{ movie.release_date }} · Duration: {{ movie.duration }} min</p>
<p>{{ movie.description }}</p>
<hr>

<style>
  button { margin: 3px; padding: 6px 10px; cursor:pointer; }
  .avail   { background:#d4f8d4; border:1px solid #2e7d32; color:#113b17; }
  .booked  { background:#ffd6d6; border:1px solid #b3261e; color:#5a1611; }
  .selected{ background:#cfe2ff; border:1px solid #0d6efd; color:#0b3d91; }
  button:disabled{ cursor:not-allowed; }
</style>

<div id="seat-area">
  {% for seat in seats %}
    {% if seat.booking_status == True %}
      <button type="button" class="booked" disabled title="Booked">{{ seat.seat_number }}</button>
    {% else %}
      <button type="button" class="avail" data-seat-id="{{ seat.id }}" data-seat-number="{{ seat.seat_number }}">{{ seat.seat_number }}</button>
    {% endif %}
    {% if forloop.counter|divisibleby:10 %}<br>{% endif %}
  {% endfor %}
</div>

<form method="post" action="{% url 'book_seat' movie.id %}">
  {% csrf_token %}
  <input type="hidden" id="seat_ids" name="seat_ids" value="">
  <p>
    <button type="submit">Confirm Booking</button>
    <a href="{% url 'movie_list' %}">Cancel</a>
  </p>
</form>

<script>
(function () {
  var selected = new Set();
  var area = document.getElementById('seat-area');
  var input = document.getElementById('seat_ids');

  area.addEventListener('click', function (e) {
    var btn = e.target.closest('button');
    if (!btn || btn.disabled) return;

    var id = btn.getAttribute('data-seat-id');

    if (selected.has(id)) {
      selected.delete(id);
      btn.classList.remove('selected');
      btn.classList.add('avail');
    } else {
      selected.add(id);
      btn.classList.remove('avail');
      btn.classList.add('selected');
    }
    input.value = Array.from(selected).join(',');
  });
})();
</script>
{% endblock %}
