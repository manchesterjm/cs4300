{% extends "bookings/base.html" %}
{% block content %}
<h2>Book Seats for: {{ movie.title }}</h2>
<p>
  Release: {{ movie.release_date|date:"M. j, Y" }} Â· Duration: {{ movie.duration }} min
</p>
<p>{{ movie.description }}</p>

<hr>

<form method="post">
  {% csrf_token %}

  <div id="seats">
    {% for seat in seats %}
      <label class="seat-label">
        <input type="checkbox" name="seats" value="{{ seat.id }}" {% if seat.booked %}disabled{% endif %}>
        <button type="button"
                class="seat-btn {% if seat.booked %}booked{% else %}available{% endif %}"
                data-seat-id="{{ seat.id }}">
          {{ seat.number }}
        </button>
      </label>
    {% endfor %}
  </div>

  <div style="margin-top:1rem;">
    <button type="submit">Confirm Booking</button>
    <a href="{% url 'movie_list' %}">Cancel</a>
  </div>
</form>

<style>
  /* keep it dead simple and readable */
  .seat-label {
    display: inline-flex;
    align-items: center;
    margin: 0.25rem 0.25rem 0 0;
  }
  .seat-label input[type="checkbox"] {
    /* hide the checkbox but keep it focusable and accessible */
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }
  .seat-btn {
    border: 1px solid #444;
    padding: 6px 10px;        /* ensures text is visible */
    background: #eee;
    color: #000;
    font: 14px/1.1 system-ui, sans-serif;
    cursor: pointer;
    border-radius: 4px;
  }
  .seat-btn.available { background: #c6f6d5; }   /* green */
  .seat-btn.booked    { background: #f8cccc; cursor: not-allowed; } /* red */
  .seat-btn.selected  { background: #cfe8ff; }  /* blue when toggled */
</style>

<script>
  // Toggle selection color without altering label text
  document.querySelectorAll('.seat-label').forEach(function (label) {
    const box = label.querySelector('input[type="checkbox"]');
    const btn = label.querySelector('.seat-btn');

    if (!box || !btn) return;

    btn.addEventListener('click', function () {
      if (btn.classList.contains('booked')) return; // ignore booked
      box.checked = !box.checked;
      btn.classList.toggle('selected', box.checked);
    });
  });
</script>
{% endblock %}
